"""Metadata generation logic for legacy source distributions.
"""

import logging
import os

<<<<<<< HEAD
<<<<<<< HEAD
from pip._internal.build_env import BuildEnvironment
from pip._internal.cli.spinners import open_spinner
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
from pip._internal.exceptions import InstallationError
from pip._internal.utils.setuptools_build import make_setuptools_egg_info_args
from pip._internal.utils.subprocess import call_subprocess
from pip._internal.utils.temp_dir import TempDirectory
<<<<<<< HEAD
<<<<<<< HEAD
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
from pip._internal.utils.typing import MYPY_CHECK_RUNNING

if MYPY_CHECK_RUNNING:
    from pip._internal.build_env import BuildEnvironment
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

logger = logging.getLogger(__name__)


<<<<<<< HEAD
<<<<<<< HEAD
def _find_egg_info(directory: str) -> str:
    """Find an .egg-info subdirectory in `directory`."""
    filenames = [f for f in os.listdir(directory) if f.endswith(".egg-info")]

    if not filenames:
        raise InstallationError(f"No .egg-info directory found in {directory}")

    if len(filenames) > 1:
        raise InstallationError(
            "More than one .egg-info directory found in {}".format(directory)
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
def _find_egg_info(directory):
    # type: (str) -> str
    """Find an .egg-info subdirectory in `directory`.
    """
    filenames = [
        f for f in os.listdir(directory) if f.endswith(".egg-info")
    ]

    if not filenames:
        raise InstallationError(
            "No .egg-info directory found in {}".format(directory)
        )

    if len(filenames) > 1:
        raise InstallationError(
            "More than one .egg-info directory found in {}".format(
                directory
            )
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        )

    return os.path.join(directory, filenames[0])


def generate_metadata(
<<<<<<< HEAD
<<<<<<< HEAD
    build_env: BuildEnvironment,
    setup_py_path: str,
    source_dir: str,
    isolated: bool,
    details: str,
) -> str:
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
    build_env,  # type: BuildEnvironment
    setup_py_path,  # type: str
    source_dir,  # type: str
    isolated,  # type: bool
    details,  # type: str
):
    # type: (...) -> str
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
    """Generate metadata using setup.py-based defacto mechanisms.

    Returns the generated metadata directory.
    """
    logger.debug(
<<<<<<< HEAD
<<<<<<< HEAD
        "Running setup.py (path:%s) egg_info for package %s",
        setup_py_path,
        details,
    )

    egg_info_dir = TempDirectory(kind="pip-egg-info", globally_managed=True).path
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        'Running setup.py (path:%s) egg_info for package %s',
        setup_py_path, details,
    )

    egg_info_dir = TempDirectory(
        kind="pip-egg-info", globally_managed=True
    ).path
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

    args = make_setuptools_egg_info_args(
        setup_py_path,
        egg_info_dir=egg_info_dir,
        no_user_config=isolated,
    )

    with build_env:
<<<<<<< HEAD
<<<<<<< HEAD
        with open_spinner("Preparing metadata (setup.py)") as spinner:
            call_subprocess(
                args,
                cwd=source_dir,
                command_desc="python setup.py egg_info",
                spinner=spinner,
            )
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        call_subprocess(
            args,
            cwd=source_dir,
            command_desc='python setup.py egg_info',
        )
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

    # Return the .egg-info directory.
    return _find_egg_info(egg_info_dir)
