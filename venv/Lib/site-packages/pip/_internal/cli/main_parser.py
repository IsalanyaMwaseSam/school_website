"""A single place for constructing and exposing the main parser
"""

import os
import sys
<<<<<<< HEAD
<<<<<<< HEAD
from typing import List, Tuple

from pip._internal.cli import cmdoptions
from pip._internal.cli.parser import ConfigOptionParser, UpdatingDefaultsHelpFormatter
from pip._internal.commands import commands_dict, get_similar_commands
from pip._internal.exceptions import CommandError
from pip._internal.utils.misc import get_pip_version, get_prog
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

from pip._internal.cli import cmdoptions
from pip._internal.cli.parser import (
    ConfigOptionParser,
    UpdatingDefaultsHelpFormatter,
)
from pip._internal.commands import commands_dict, get_similar_commands
from pip._internal.exceptions import CommandError
from pip._internal.utils.misc import get_pip_version, get_prog
from pip._internal.utils.typing import MYPY_CHECK_RUNNING

if MYPY_CHECK_RUNNING:
    from typing import Tuple, List

<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

__all__ = ["create_main_parser", "parse_command"]


<<<<<<< HEAD
<<<<<<< HEAD
def create_main_parser() -> ConfigOptionParser:
    """Creates and returns the main parser for pip's CLI"""

    parser = ConfigOptionParser(
        usage="\n%prog <command> [options]",
        add_help_option=False,
        formatter=UpdatingDefaultsHelpFormatter(),
        name="global",
        prog=get_prog(),
    )
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
def create_main_parser():
    # type: () -> ConfigOptionParser
    """Creates and returns the main parser for pip's CLI
    """

    parser_kw = {
        'usage': '\n%prog <command> [options]',
        'add_help_option': False,
        'formatter': UpdatingDefaultsHelpFormatter(),
        'name': 'global',
        'prog': get_prog(),
    }

    parser = ConfigOptionParser(**parser_kw)
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
    parser.disable_interspersed_args()

    parser.version = get_pip_version()

    # add the general options
    gen_opts = cmdoptions.make_option_group(cmdoptions.general_group, parser)
    parser.add_option_group(gen_opts)

    # so the help formatter knows
    parser.main = True  # type: ignore

    # create command listing for description
<<<<<<< HEAD
<<<<<<< HEAD
    description = [""] + [
        f"{name:27} {command_info.summary}"
        for name, command_info in commands_dict.items()
    ]
    parser.description = "\n".join(description)
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
    description = [''] + [
        '{name:27} {command_info.summary}'.format(**locals())
        for name, command_info in commands_dict.items()
    ]
    parser.description = '\n'.join(description)
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

    return parser


<<<<<<< HEAD
<<<<<<< HEAD
def parse_command(args: List[str]) -> Tuple[str, List[str]]:
=======
def parse_command(args):
    # type: (List[str]) -> Tuple[str, List[str]]
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
def parse_command(args):
    # type: (List[str]) -> Tuple[str, List[str]]
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
    parser = create_main_parser()

    # Note: parser calls disable_interspersed_args(), so the result of this
    # call is to split the initial args into the general options before the
    # subcommand and everything else.
    # For example:
    #  args: ['--timeout=5', 'install', '--user', 'INITools']
    #  general_options: ['--timeout==5']
    #  args_else: ['install', '--user', 'INITools']
    general_options, args_else = parser.parse_args(args)

    # --version
    if general_options.version:
<<<<<<< HEAD
<<<<<<< HEAD
        sys.stdout.write(parser.version)
=======
        sys.stdout.write(parser.version)  # type: ignore
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
        sys.stdout.write(parser.version)  # type: ignore
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        sys.stdout.write(os.linesep)
        sys.exit()

    # pip || pip help -> print_help()
<<<<<<< HEAD
<<<<<<< HEAD
    if not args_else or (args_else[0] == "help" and len(args_else) == 1):
=======
    if not args_else or (args_else[0] == 'help' and len(args_else) == 1):
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
    if not args_else or (args_else[0] == 'help' and len(args_else) == 1):
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        parser.print_help()
        sys.exit()

    # the subcommand name
    cmd_name = args_else[0]

    if cmd_name not in commands_dict:
        guess = get_similar_commands(cmd_name)

<<<<<<< HEAD
<<<<<<< HEAD
        msg = [f'unknown command "{cmd_name}"']
        if guess:
            msg.append(f'maybe you meant "{guess}"')

        raise CommandError(" - ".join(msg))
=======
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
        msg = ['unknown command "{}"'.format(cmd_name)]
        if guess:
            msg.append('maybe you meant "{}"'.format(guess))

        raise CommandError(' - '.join(msg))
<<<<<<< HEAD
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23
=======
>>>>>>> a9d900c1457080d90d61291d4e50f857aa62fa23

    # all the args without the subcommand
    cmd_args = args[:]
    cmd_args.remove(cmd_name)

    return cmd_name, cmd_args
